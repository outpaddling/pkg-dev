#!/bin/sh -e

if [ $# -gt 1 ]; then
    printf "Usage: $0 [dir]\n"
    exit 1
fi

make=`pkgsrc-make`
if [ $# = 1 ]; then
    pkgsrc=`pkgsrc-dir`
    dir=`echo $pkgsrc/*/$1`
    count=`echo $dir | wc -w`
    if [ $count -gt 1 ]; then
	printf "Ambiguous: $dir\n"
	exit 1
    fi
    cd $dir
fi

printf "Remove distfile? y/[n] "
read remove
if [ 0$remove = 0y ]; then
    $make distclean
else
    $make clean
fi
# Rebuild before deinstalling to minimize uninstalled time
$make
$make deinstall
$make install
